<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>SzakiPiac – Hirdetés feltöltése</title>
</head>
<body>
  <h1>SzakiPiac – Hirdetés feltöltése</h1>
  <form id="hirdetesForm">
    <label for="cim">Cím:</label><br />
    <input type="text" id="cim" name="cim" required /><br />
    <label for="leiras">Leírás:</label><br />
    <textarea id="leiras" name="leiras" required></textarea><br />
    <label for="ar">Ár (Ft):</label><br />
    <input type="number" id="ar" name="ar" required /><br />
    <label for="email">E-mail:</label><br />
    <input type="email" id="email" name="email" required /><br /><br />
    <div id="paypal-button-container"></div>
  </form>

  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=HUF"></script>
  <script>
    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: { value: '990' }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          const formData = {
            cim: document.getElementById("cim").value,
            leiras: document.getElementById("leiras").value,
            ar: parseInt(document.getElementById("ar").value),
            email: document.getElementById("email").value
          };

          fetch("https://tzmcofiuqeanftviquwp.supabase.co/rest/v1/hirdetesek", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6bWNvZml1cWVhbmZ0dmlxdXdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1ODAzMjYsImV4cCI6MjA2NjE1NjMyNn0.oxD20AplWIl7p6znO0GoVxDWX7aeD_8fhFRmooS2xm4",
              "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6bWNvZml1cWVhbmZ0dmlxdXdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1ODAzMjYsImV4cCI6MjA2NjE1NjMyNn0.oxD20AplWIl7p6znO0GoVxDWX7aeD_8fhFRmooS2xm4"
            },
            body: JSON.stringify(formData)
          }).then(response => {
            if (response.ok) {
              alert("Hirdetés sikeresen feltöltve!");
              document.getElementById("hirdetesForm").reset();
            } else {
              alert("Hiba történt a feltöltés során.");
            }
          });
        });
      }
    }).render("#paypal-button-container");
  </script>
</body>
</html>